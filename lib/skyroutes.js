/*


    ___         __              __       ____                  __
   /   | ____ _/ /______ ______/ /_     / __ \____ _____  ____/ /__  __  __
  / /| |/ __ `/ //_/ __ `/ ___/ __ \   / /_/ / __ `/ __ \/ __  / _ \/ / / /
 / ___ / /_/ / ,< / /_/ (__  ) / / /  / ____/ /_/ / / / / /_/ /  __/ /_/ /
/_/  |_\__,_/_/|_|\__,_/____/_/ /_/  /_/    \__,_/_/ /_/\__,_/\___/\__, /
                                                                  /____/

All Rights Reserved : Aakash Pandey : aakash.pandey@live.com : 2019-2020

SKYROUTES v2.0B


*/


const e={};let a,s=!1,r=!1,o=!1;const n=(e,t,a)=>{let s=document.getElementById(e);0===t?0===a?(s.classList.remove("vis"),s.classList.add("rt")):(s.classList.remove("viss"),s.classList.add("rt")):1===t&&(s.classList.contains("irt")&&s.classList.toggle("irt"),0===a?(s.classList.remove("rt"),s.classList.add("vis")):(s.classList.remove("rt"),s.classList.add("viss")))},l=(e,t)=>{let a=document.getElementById(e);0==t?(a.classList.toggle("show"),a.style.display="none"):(a.classList.toggle("show"),a.style.display="block")},p=[],nav=e=>{let t;if(s&&o&&(s=!1,o=!1,d()),e||""===e){let s=(t=a[e])||e;""!==e?history.pushState({path:t},"SkyRoute",`/${s}`):history.pushState({path:t},"SkyRoute","/")}else t=a[location.pathname.slice(1)];p.push(e),(()=>{let e=document.querySelectorAll(".vis"),t=document.querySelectorAll(".viss");if(t.length>e.length)for(i=0;i<t.length;i++)t[i].classList.remove("viss"),t[i].classList.add("rt");else for(i=0;i<e.length;i++)e[i].classList.remove("vis"),e[i].classList.add("rt")})(),t?n(t,1,0):(trn=location.pathname.slice(1),"index.html"==trn&&nav(""),e=e||location.pathname.slice(1),o=!0,t=e,"hold"===myApp.route_error?(d({msg:`Error 404 ${t} Not Found`}),s=!0):(southBridge({req:"gracenav"}),window.location=`${location.origin}/${t}`));try{pathEvents(location.pathname.slice(1))}catch(e){}};var c;const d=e=>{if(!sr_halt)if(e){if(s)return;document.querySelector("#sr_intr p").innerText=e.msg?e.msg:"",l("sr_intr",1)}else{if(s)return;document.querySelector("#sr_intr p").innerText="",l("sr_intr",0)}},southBridge=t=>{e.new?e.new.postMessage({req:t.req,data:t.data}):e.active?e.active.active.postMessage({req:t.req,data:t.data}):navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({req:t.req,data:t.data})},m=async()=>{if(r&&window.location.reload(),sr_halt)return;let e=await fetch("../app.html");if(e=await e.text(),document.getElementById("sr_main").innerHTML=e,localStorage.myApp||d(),void 0===a)(()=>{let e={},t=document.querySelectorAll(".irt");try{for(e[""]=t[0].id,t=document.querySelectorAll(".rt"),i=0;i<t.length;i++)e[t[i].id]=t[i].id;localStorage.Path=JSON.stringify(e)}catch(t){return}a=JSON.parse(localStorage.Path),nav()})();else{let e=location.pathname.slice(1);e=""===e?a[""]:e,n(e,1,1)}};window.onfocus=(()=>{(e=>{if(void 0!==myApp)if("full"===myApp.hot_reload)window.location.reload();else if("silent"===myApp.hot_reload||"css"===myApp.hot_reload){for("silent"===myApp.hot_reload&&m(),ss=document.getElementsByClassName("style"),i=0;i<ss.length;i++)/Chrome/.test(navigator.userAgent)?ss[i].href=ss[i].href:(t=ss[i].href,ss[i].href="",ss[i].href=t)}})()});const g=async()=>{"serviceWorker"in navigator!=!1?(navigator.serviceWorker.controller?(southBridge({req:"touch",data:myApp.assets}),navigator.serviceWorker.addEventListener("message",e=>{let t=e.data.req,a=e.data.data;if("cacheon"===t||"cacheoff"===t)southBridge({req:t});else if("fsync"===t){void 0===localStorage.myApp&&(localStorage.myApp=JSON.stringify(myApp),window.location.reload());let e=localStorage.myApp?JSON.parse(localStorage.myApp).assets:myApp.assets;if(0===a.cmp){southBridge({req:"fsync",data:{delete:e,add:a.add}}),southBridge({req:"touch",data:myApp.assets}),localStorage.lastUpdate=(new Date).getTime();let t=JSON.parse(localStorage.myApp);return t.assets=[],void(localStorage.myApp=JSON.stringify(t))}if(a.cmp&&a.cmp.length>0&&e.toString()!==a.cmp.toString()){let t=e.filter(e=>!a.cmp.includes(e)),s=a.cmp.filter(t=>!e.includes(t)),r=JSON.parse(localStorage.myApp);return r.assets=a.cmp,localStorage.myApp=JSON.stringify(r),s=s.concat(a.add),southBridge({req:"fsync",data:{delete:t,add:s}}),southBridge({req:"touch",data:r.assets}),void(localStorage.lastUpdate=(new Date).getTime())}a.add&&a.add.length>0&&southBridge({req:"fsync",data:{add:a.add}})}else"reinit"===t?(d({msg:""}),localStorage.myApp=JSON.stringify(myApp),southBridge({req:"init",data:myApp.assets}),localStorage.lastUpdate=(new Date).getTime()):"reboot"===t?(localStorage.lastUpdate=(new Date).getTime(),d({msg:""}),setTimeout(()=>{window.location.reload()},700)):"load"===t&&(localStorage.lastUpdate=(new Date).getTime(),m(),setTimeout(()=>d(),600),localStorage.myApp||(localStorage.myApp=JSON.stringify(myApp)))}),void 0===e.active&&(e.active=await navigator.serviceWorker.register("/sw.js")),(e.new=e.active.waiting)&&southBridge({req:"upsw"}),e.active.addEventListener("updatefound",()=>{d({msg:""}),e.new=e.active.installing,e.new.addEventListener("statechange",()=>{"installed"===e.new.state&&navigator.serviceWorker.controller&&(southBridge({req:"upsw"}),southBridge({req:"touch",data:myApp.assets}),southBridge({req:"init"}),e.active=e.new,southBridge({req:"touch",data:myApp.assets}),r=!0)})})):(d({msg:""}),e.active=await navigator.serviceWorker.register("/sw.js").catch(e=>{d({msg:"App couldn't be initialized"})}),setTimeout(()=>{southBridge({req:"init",data:myApp.assets}),localStorage.lastUpdate=(new Date).getTime(),setTimeout(()=>{m()},200)},200)),localStorage.lastUpdate?localStorage.lastUpdate&&parseInt(myApp.update_interval)>0?(new Date).getTime()-parseInt(localStorage.lastUpdate)<6e4*parseInt(myApp.update_interval)?m():(d({msg:""}),southBridge({req:"atomic"})):0===parseInt(myApp.update_interval)?(d({msg:"Dev mode"}),southBridge({req:"atomic"})):parseInt(myApp.update_interval)<0&&m():localStorage.lastUpdate=(new Date).getTime()):d({msg:"ðŸ’” PWAs not supported, please update your browser."})};window.addEventListener("load",()=>{window.addEventListener("popstate",()=>{nav()}),(()=>{if(window.myApp)return!myApp.name&&(myApp.name="SkyRoutes"),!myApp.theme&&(myApp.theme="#EFEFEF"),(!myApp.logo||""===myApp.logo)&&(myApp.logo="/assets/sr.jpeg"),document.querySelector("#sr_intr img").src=myApp.logo,document.querySelector("#sr_intr div").innerText=myApp.name,0!==!myApp.assets.length&&!myApp.length||Array.isArray(myApp.assets)?/true|false/.test(myApp.anti_scrape)?/true|false/.test(myApp.force_install)?/free|hold/.test(myApp.route_error)?/css|silent|full|false/.test(myApp.hot_reload)?isNaN(parseInt(myApp.update_interval))?(d({msg:"In myApp object, update_interval invalid"}),void(s=!0)):void 0:(d({msg:'In myApp object, hot_reload must be "css" / "silent" / "full" / "false"'}),void(s=!0)):(d({msg:'In myApp object, route_error must be "free" or "hold"'}),void(s=!0)):(d({msg:'In myApp object, force_install must be "true" or "false"'}),void(s=!0)):(d({msg:'In myApp object, anti_scrape must be "true" or "false"'}),void(s=!0)):(d({msg:"In myApp object, assets should at least be an empty array"}),void(s=!0));navigator.serviceWorker.addEventListener("message",e=>{"reboot"===e.data.req&&window.location.reload()})})(),(()=>(g(),s&&setTimeout(()=>{southBridge({req:"atomic"})},1e3),window.matchMedia("(display-mode: standalone)").matches||"true"!==myApp.force_install?"true"!==myApp.force_network||navigator.onLine?!0!==navigator.webdriver&&!window.document.documentElement.getAttribute("webdriver")||"true"!==myApp.anti_scrape?void 0:(document.querySelector("#sr_main").innerHTML="",d({msg:"We wouldn't appreciate that here..."}),void(sr_halt=!0)):(d({msg:"Please check your internet connection"}),void(sr_halt=!0)):(d({msg:"Please add to homescreen"}),void(sr_halt=!0))))()});const y=e=>{myApp&&("true"===myApp.force_network&&0===e?d({msg:"Please check your internet connection"}):"true"===myApp.force_network&&1===e&&(d(),m()))};navigator.onLine?y(1):y(0),window.addEventListener("offline",e=>{y(0)}),window.addEventListener("online",e=>{!0===sr_halt&&"true"===myApp.force_network&&(sr_halt=!1),y(1)});
